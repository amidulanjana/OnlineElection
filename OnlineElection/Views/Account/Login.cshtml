@{
    ViewData["Title"] = "Login Page";
    Layout = "~/Views/Shared/_LayoutAccount.cshtml";
}

<style>
    .loginform {
        margin-top: 70px;
    }

    .loginHead {
        margin-left: 150px;
    }
</style>





<div class="row loginform">
    <div class="col s10 m8 l4 offset-l4 offset-m2 offset-s1">

        <div class="card">
            <div class="card-content">
                <div class="card-title center-align"><h4>Login Form</h4></div>
                <div class="row">

                    <form id="form" class="col s12" novalidate="novalidate" method="post">
                        <div class="row">

                            <div class="input-field col s12">
                                <i class="material-icons prefix">subtitles</i>
                                <input id="SID" name="SID" type="text" required="" aria-required="true" class="validate">
                                <label for="SID">SLIIT ID</label>
                            </div>

                            <div class="input-field col s12">
                                <i class="material-icons prefix">lock_outline</i>
                                <input id="password" type="password" name="password"  required="" aria-required="true" class="validate" minlength="4">
                                <label for="password">Password</label>
                            </div>

                            <div class="input-field col s12">
                                <input type="checkbox" id="remember-me" />
                                <label for="remember-me">Remember me</label>
                            </div>

                            <div class="input-field col s12" style="margin-top:40px">
                                <button class="btn waves-effect waves-light" type="submit" name="action" style="width:100%">Submit</button>
                            </div>
                            <div class="input-field col s6 m6 l6" style="margin-top:20px">
                               <a href="Register">Register Now</a>
                            </div>
                            <div class="input-field col s6 m6 l6 " style="margin-bottom:10px">
                                <a href="forgot-password.html">Forgot password?</a>
                            </div>


                                <div class="input-field col s12 m12 l12 card-panel red red lighten-1" style="height:30px;margin-bottom:-30px" hidden id="showError">
                                    <div class="row">
                                        <div class="col l12 m12 s12 white-text" style="height:30px;position:center">
                                            <h6 style="font-family:Roboto Condensed;" id="error"></h6>

                                        </div>

                                    </div>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>

        $.validator.setDefaults({
            errorClass: 'invalid',
            validClass: "valid",
            errorPlacement: function (error, element) {
                $(element)
                    .closest("form")
                    .find("label[for='" + element.attr("id") + "']")
                    .attr('data-error', error.text());
            },
            submitHandler: function () {

                event.preventDefault();
                var SID = $("[name='SID']").val();
                var password = $("[name='password']").val();

                var user = {

                    SID: SID,
                    password: password

                }

                // console.log(SID + " " + email + " " + password);

                $.ajax({
                    type: 'POST',
                    url: 'Login',
                    contentType: 'application/json',
                    data: JSON.stringify(user),
                    dataType: 'Json',
                    async: true,
                    success: function (data) {

                        // Materialize.toast('You will recieve an email by confirming </br> your request. Thank you !', 4000, 'blue')
                        if (data.userFound==false) {
                            $("#showError").show();
                            $('#error').html("");
                            $('#error').html("User is Not Found");
                        }
                        else if (!data.passwordVerify) {
                            $("#showError").show();
                            $('#error').html("");
                            $('#error').html("Password is invalid");
                        }
                        else if (!data.adminApprove) {
                            $("#showError").show();
                            $('#error').html("");
                            $('#error').html("Admin is not approved your account");
                        }
                        else {
                            window.location.replace("LoggedIn");
                        }


                    }

                });

            }
        });

        $("#form").validate({
            rules: {
                SID: {
                    required: true,
                    minlength: 10,
                    maxlength: 10
                }
            },

            messages: {
                SID: {
                    minlength: "Enter valid SLIIT ID",
                    maxlength: "Enter valid SLIIT ID"
                }
            }
        });

    </script>
}



